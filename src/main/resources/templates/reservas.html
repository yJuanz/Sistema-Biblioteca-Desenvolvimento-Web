<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Reservas - Biblioteca</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<header class="header">
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-book"></i>
            <span>Biblioteca Universitária</span>
        </div>
        <ul class="nav-links">
            <li><a href="/"><i class="fas fa-home"></i> Início</a></li>
            <li><a href="/livros"><i class="fas fa-book"></i> Livros</a></li>
            <li><a href="/usuarios"><i class="fas fa-users"></i> Usuários</a></li>
            <li><a href="/emprestimos"><i class="fas fa-exchange-alt"></i> Empréstimos</a></li>
            <li><a href="/reservas" class="active"><i class="fas fa-calendar-check"></i> Reservas</a></li>
            <li><a href="/relatorios"><i class="fas fa-chart-bar"></i> Relatórios</a></li>
        </ul>
    </nav>
</header>

<main class="container">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h2><i class="fas fa-calendar-check"></i> Gestão de Reservas</h2>
            <a href="/reservas/nova" class="btn btn-primary">
                <i class="fas fa-plus"></i> Nova Reserva (Página)
            </a>
        </div>

        <div th:if="${param.sucesso}" class="alert alert-success" style="background-color: #d4edda; color: #155724; padding: 1rem; margin-bottom: 1rem; border-radius: 5px;">
            <i class="fas fa-check-circle"></i> <span th:text="${param.sucesso}"></span>
        </div>
        <div th:if="${param.error}" class="alert alert-danger" style="background-color: #f8d7da; color: #721c24; padding: 1rem; margin-bottom: 1rem; border-radius: 5px;">
            <i class="fas fa-exclamation-triangle"></i> <span th:text="${param.error}"></span>
        </div>

        <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
            <input type="text" class="form-control" placeholder="Buscar por livro..." style="flex: 1; min-width: 200px;">
            <button class="btn btn-primary">
                <i class="fas fa-search"></i> Buscar
            </button>
        </div>
    </div>

    <div style="display: flex; gap: 0; border-bottom: 2px solid #ecf0f1; margin-bottom: 1rem;">
        <button class="tab-btn active" onclick="showTab('ativas')">Reservas Ativas</button>
        <button class="tab-btn" onclick="showTab('expiradas')">Expiradas</button>
    </div>

    <div class="card tab-content" id="ativas-tab">
        <h3><i class="fas fa-clock"></i> Reservas Ativas</h3>
        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>Usuário</th>
                    <th>Livro</th>
                    <th>Data Reserva</th>
                    <th>Expira em</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="reserva : ${reservasAtivas}">
                    <td th:text="${reserva.usuario.nome}">Ana Pereira</td>
                    <td th:text="${reserva.livro.titulo}">Java para Iniciantes</td>
                    
                    <td th:text="${#temporals.format(reserva.dataReserva, 'dd/MM/yyyy')}">10/11/2024</td>
                    
                    <td>
                        <span class="status status-disponivel"
                              th:text="${#temporals.format(reserva.dataExpiracao, 'dd/MM/yyyy')}">
                            17/11/2024
                        </span>
                    </td>
                    
                    <td><span class="status status-ativo">ATIVA</span></td>
                </tr>
                <tr th:if="${reservasAtivas == null or reservasAtivas.empty}">
                    <td colspan="5" style="text-align: center;">
                        <div class="loading">Nenhuma reserva ativa</div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card tab-content" id="expiradas-tab" style="display: none;">
        <h3><i class="fas fa-exclamation-triangle"></i> Reservas Expiradas</h3>
        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>Usuário</th>
                    <th>Livro</th>
                    <th>Data Expiração</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="reserva : ${reservasExpiradas}">
                    <td th:text="${reserva.usuario.nome}">Ana Pereira</td>
                    <td th:text="${reserva.livro.titulo}">Java para Iniciantes</td>
                    
                    <td th:text="${#temporals.format(reserva.dataExpiracao, 'dd/MM/yyyy')}">17/11/2024</td>
                    
                    <td><span class="status status-emprestado">EXPIRADA</span></td>
                </tr>
                <tr th:if="${reservasExpiradas == null or reservasExpiradas.empty}">
                    <td colspan="4" style="text-align: center;">
                        <div class="loading">Nenhuma reserva expirada</div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <h3><i class="fas fa-plus-circle"></i> Nova Reserva Rápida</h3>
        <form action="/reservas/nova" method="post">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="usuarioId">Usuário:</label>
                    <select class="form-control" id="usuarioId" name="usuarioId" required>
                        <option value="">Selecione um usuário...</option>
                        <option th:each="usuario : ${usuarios}" 
                                th:value="${usuario.id}" 
                                th:text="${usuario.nome + ' - ' + usuario.matricula}">
                        </option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="livroId">Livro:</label>
                    <select class="form-control" id="livroId" name="livroId" required>
                        <option value="">Selecione um livro...</option>
                        <option th:each="livro : ${livros}" 
                                th:value="${livro.id}" 
                                th:text="${livro.titulo}">
                        </option>
                    </select>
                </div>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Fazer Reserva
                </button>
            </div>
        </form>
    </div>

</main>

<footer class="footer">
    <p>&copy; 2024 Sistema de Biblioteca Universitária</p>
</footer>

<script th:inline="javascript">
    function showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
        });
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.getElementById(tabName + '-tab').style.display = 'block';
        event.target.classList.add('active');
    }

    const style = document.createElement('style');
    style.textContent = `
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
        }
        .tab-btn:hover { color: #3498db; }
        .tab-btn.active { color: #3498db; border-bottom-color: #3498db; }
    `;
    document.head.appendChild(style);

    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const sucesso = urlParams.get('sucesso');
        const erro = urlParams.get('error');

        if (sucesso) {
            alert('✅ ' + decodeURIComponent(sucesso));
            window.history.replaceState({}, document.title, window.location.pathname);
        }

        if (erro) {
            alert('❌ ' + decodeURIComponent(erro));
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    });
</script>
</body>
</html>